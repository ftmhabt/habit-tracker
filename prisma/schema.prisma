generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --------------- USER & SOCIAL MODELS ---------------

model User {
  id            String    @id @default(cuid())
  username      String    @unique
  email         String    @unique
  passwordHash  String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  profile       Profile?
  habits        Habit[]
  followers     Follow[]  @relation("UserFollowers")
  following     Follow[]  @relation("UserFollowing")
  assets        Asset[]
  themes        Theme[]
  layouts       Layout[]
}

// ✅ both sides of the relation must match
model Follow {
  id           String   @id @default(cuid())
  followerId   String
  followingId  String
  createdAt    DateTime @default(now())

  follower     User     @relation("UserFollowing", fields: [followerId], references: [id])
  following    User     @relation("UserFollowers", fields: [followingId], references: [id])

  @@unique([followerId, followingId])
}

// --------------- PROFILE & CUSTOMIZATION ---------------

model Profile {
  id            String   @id @default(cuid())
  userId        String   @unique
  bio           String?
  avatarUrl     String?
  bannerUrl     String?
  themeId       String?
  layoutId      String?
  preferences   Json?
  updatedAt     DateTime @updatedAt

  user          User     @relation(fields: [userId], references: [id])
  theme         Theme?   @relation(fields: [themeId], references: [id])
  layout        Layout?  @relation(fields: [layoutId], references: [id])
}

// --------------- HABIT MODELS ---------------

model Habit {
  id          String   @id @default(cuid())
  userId      String
  title       String
  description String?
  frequency   String
  progress    Json?
  visualId    String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id])
  visual      PinStyle? @relation(fields: [visualId], references: [id])
}

// --------------- VISUAL CUSTOMIZATION ---------------

model Theme {
  id           String   @id @default(cuid())
  userId       String
  name         String
  description  String?
  baseColor    String
  surfaceColor String
  textColor    String
  accentColor  String?
  gridColor    String?
  marginColor  String?
  textureUrl   String?
  fontHeading  String?
  fontBody     String?
  radius       String?
  shadow       String?
  meta         Json?
  createdAt    DateTime @default(now())

  user         User     @relation(fields: [userId], references: [id])
  profiles     Profile[] // ✅ opposite of Profile.theme
}

model Layout {
  id          String   @id @default(cuid())
  userId      String
  name        String
  gridType    String
  spacing     String
  columns     Int
  pinShape    String
  showGrid    Boolean  @default(true)
  showMargin  Boolean  @default(true)
  extras      Json?
  createdAt   DateTime @default(now())

  user        User     @relation(fields: [userId], references: [id])
  profiles    Profile[] // ✅ opposite of Profile.layout
}

model PinStyle {
  id          String   @id @default(cuid())
  name        String?
  color       String?
  icon        String?
  pattern     String?
  shape       String?
  glow        Boolean? @default(false)
  textureUrl  String?
  accentColor String?
  meta        Json?

  habits      Habit[] // ✅ opposite of Habit.visual
}

// --------------- CREATIVE ASSETS ---------------

model Asset {
  id          String   @id @default(cuid())
  userId      String
  url         String
  type        String
  altText     String?
  createdAt   DateTime @default(now())

  user        User     @relation(fields: [userId], references: [id])
}

model ThemePreset {
  id          String   @id @default(cuid())
  name        String
  description String?
  previewUrl  String?
  theme       Json
  createdById String?
  createdAt   DateTime @default(now())
}
